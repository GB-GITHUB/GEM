<?xml version="1.0"?>
<task>

	<name>fact_orders</name>
	<blocker>false</blocker>

	<parameter>
		<name>batch_id</name>
		<default>0</default>
		<query>
			<![CDATA[
				select max(batch_id) as batch_id 
				from ${TARGET_TABLE_NAME}
			]]>
		</query>
	</parameter>
	<source>
		<type>DB</type>
		<query>
			<![CDATA[
				select
				  order_number
				, order_date
				, customer_number
				, row_number		as source_row_number
				, batch_id 			as source_batch_id
				from stage_orders
				where batch_id > ${batch_id}
			]]>
		</query>
	</source>

	<transform>
		<transformation>fact_orders.ktr</transformation>
	</transform>

	<target>
		<loader>MySQL</loader>
		<table>
			<name>fact_orders</name>
		</table>
	</target>

</task>
