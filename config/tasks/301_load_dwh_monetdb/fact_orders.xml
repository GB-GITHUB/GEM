<?xml version="1.0"?>
<task>

	<name>fact_orders</name>
	<blocker>true</blocker>



	<parameter>
		<name>batch_id</name>
		<default>0</default>
		<query>
			<![CDATA[
				SELECT 
				  MAX(sales_orderdetail_batch_id) 	AS batch_id
				FROM
				  ${TARGET_TABLE_NAME}
			]]>
		</query>
	</parameter>



	<source>
		<type>DB</type>
		<query>
			<![CDATA[
				SELECT
				  *
				FROM 	
				  fact_orders
				WHERE
					sales_orderdetail_batch_id > ${batch_id}
				]]>
		</query>
	</source>


<postProcessing>
		<sourceQuery>
			<![CDATA[
				DELETE FROM 
					fact_sales
				WHERE
					sales_orderdetail_batch_id < ( select max( sales_orderdetail_batch_id ) from fact_sales)
			]]>
		</sourceQuery>
	</postProcessing>



	<transform>
		<transformation>dummy.ktr</transformation>
	</transform>

	<target>
		<loader>MonetDB</loader>
		<table>
			<name>fact_orders</name>
		</table>
	</target>


</task>